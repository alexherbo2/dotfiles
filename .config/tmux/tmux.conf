# tmux
# https://github.com/tmux/tmux
# https://man.openbsd.org/tmux
# https://man.openbsd.org/tmux#DEFAULT_KEY_BINDINGS
# https://github.com/tmux/tmux/blob/master/key-bindings.c
#
# Other configuration files:
#
# https://github.com/fabi1cazenave/dotFiles/blob/master/tmux.conf
# https://github.com/topisani/dotfiles/blob/master/config/tmux/tmux.conf
# https://gitlab.com/vbauerster/dotfiles/-/blob/master/.config/tmux/tmux.conf
# https://hg.stevelosh.com/dotfiles/file/tip/tmux/tmux.conf

# Options ----------------------------------------------------------------------

# Leader key
# Prefix
# Send keys
# Change the default prefix key.
set-option -g prefix `
unbind-key C-b
bind-key ` send-prefix

# Fixes delay in modal applications
set-option -s -g escape-time 0

# Start numbering at 1
set-option -g base-index 1 # Window
set-option -w -g pane-base-index 1

# Automatically renumber windows
set-option -g renumber-windows on

# Enable features
set-option -g mouse on
set-option -g focus-events on
set-option -s set-clipboard on

# Colors and attributes
set-option -g default-terminal tmux

# Terminal features
# https://man.openbsd.org/tmux#terminal-features__
set-option -a -s terminal-features 'alacritty:RGB'
set-option -a -s terminal-features 'foot:RGB'

# Appearance -------------------------------------------------------------------

# Status line
# [code] [1] 2 3 ... Mon 2006-01-02 15:04

# Tab bar appearance and colors
# Status format for left and right parts
set-option -g status-style 'fg=black,bg=#{?#{==:#{client_key_table},root},green,yellow}'
set-option -g status-left '[#{session_name}] '
set-option -g status-left-length 40
set-option -g status-right '#{?#{==:#{client_key_table},root},,mode=#{client_key_table}} %a %F %R'

# Tab title format
# Status format for windows
set-option -g window-status-format ' #{window_index} '
set-option -g window-status-current-format '#{?window_zoomed_flag,(#{window_index}),[#{window_index}]}'

# Key bindings -----------------------------------------------------------------

# Enter command mode
bind-key Enter command-prompt

# Reload tmux config.
bind-key C-r source-file ~/.config/tmux/tmux.conf

# Full-screen
bind-key -n M-Enter resize-pane -Z

# Select a session
bind-key -n M-Space display-popup -T switch-session -E sh -c "
  tmux list-sessions -F '#{session_name}' | fzy | xargs tmux switch-client -t
"

# Create a new session.
bind-key S new-session

# Duplicate session.
bind-key D run-shell -C "
  new-session -t '#{session_name}'
"

# Rename session.
bind-key r rename-session '#{pane_current_command}'
bind-key R rename-session '#{b:pane_current_path}'

# Create windows
bind-key c new-window -a -c '#{pane_current_path}'
bind-key C new-window

# Split panes
bind-key o split-window -v -c '#{pane_current_path}'
bind-key O split-window -h -c '#{pane_current_path}'

# Pane picker
bind-key Down choose-tree -Z { join-pane -v -s '%%' }
bind-key Right choose-tree -Z { join-pane -h -s '%%' }
bind-key Up display-panes -d 0 { join-pane -v -s '%%' }
bind-key Left display-panes -d 0 { join-pane -h -s '%%' }

# Move window to another session.
bind-key A display-popup -T move-window-to-session -E sh -c "
  tmux list-sessions -F '#{session_name}' | fzy | xargs -I {} tmux move-window -t {}: ';' switch-client -t {}
"

# Focus panes
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Move panes
bind-key H swap-pane -s '{left-of}'
bind-key J swap-pane -s '{down-of}'
bind-key K swap-pane -s '{up-of}'
bind-key L swap-pane -s '{right-of}'

# Resize panes
bind-key -r C-h resize-pane -L 5
bind-key -r C-j resize-pane -D 2
bind-key -r C-k resize-pane -U 2
bind-key -r C-l resize-pane -R 5

# Switch tabs
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t '#{last_window_index}'

# Move windows
bind-key -r P { swap-window -t :-1 ; previous-window }
bind-key -r N { swap-window -t :+1 ; next-window }

# Clipboard --------------------------------------------------------------------

# vi key-bindings
set-option -g mode-keys vi

# Enter copy mode with `v` for visual.
bind-key v copy-mode
bind-key C-v paste-buffer -p

# Copy mode
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection
bind-key -T copy-mode-vi i send-keys -X cancel
