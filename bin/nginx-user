#!/bin/sh

XDG_CONFIG_HOME=${XDG_CONFIG_HOME:-~/.config}
XDG_CACHE_HOME=${XDG_CACHE_HOME:-~/.cache}

nginx_config=$XDG_CONFIG_HOME/nginx/nginx.conf
nginx_cache=$XDG_CACHE_HOME/nginx
nginx_logs=$nginx_cache/logs

mkdir --parents "$nginx_logs"

nginx_user() {
  sudo nginx -p "$nginx_cache" -c "$nginx_config" "$@"
}

nginx_user_toggle() {
  if test -e "$nginx_logs/nginx.pid"; then
    echo 'Stopping nginx'
    nginx_user -s quit
  else
    echo 'Starting nginx'
    nginx_user
  fi
}

if test $# = 0; then
  nginx_user_toggle
elif test $# = 1 -a $1 = start; then
  nginx_user
elif test $# = 1 -a $1 = stop; then
  nginx_user -s quit
elif test $# = 1 -a $1 = reload; then
  nginx_user -s reload
else
  nginx_user "$@"
fi
