#!/bin/sh

if test ! -e Gemfile; then
  cat > Gemfile <<EOF
source 'https://rubygems.org'
EOF
  $EDITOR Gemfile
fi

if test ! -e gemset.nix; then
  nix-shell --packages bundler bundix --run '
    bundle lock
    bundix
  '
fi

cat > shell.nix <<EOF
with import <nixpkgs> {};
let
  gems = bundlerEnv {
    name = "gems";
    inherit ruby;
    gemdir = ./.;
  };
in mkShell {
  buildInputs = [ gems gems.wrappedRuby ];
}
EOF
