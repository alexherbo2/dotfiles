#!/bin/sh

FILTER=${FILTER:-fzf}

emissions=$(
  curl --silent --location radiokawa.com/les-archives/ |
  pcregrep --only-matching=1 'radiokawa.com/([a-z-]+/[a-z-]+)/' |
  egrep --invert-match '^(comments|voix|wp)' |
  sort |
  uniq |
  $FILTER
)

test $? = 0 || {
  exit 1
}

for emission in $emissions; do
  IFS=/ read category name <<EOF
    $emission
EOF
  rss-get http://feeds.radiokawa.com/podcast_$name.xml '#{item.enclosure.url}' |
  tac
done
