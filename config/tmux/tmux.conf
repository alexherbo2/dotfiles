# tmux
# https://github.com/tmux/tmux
#
# Configuration:
#
# https://github.com/fabi1cazenave/dotFiles/blob/master/tmux.conf
# https://github.com/topisani/dotfiles/blob/master/home/tmux.conf
# https://gitlab.com/vbauerster/dotfiles/-/blob/master/.config/tmux/tmux.conf
# https://hg.stevelosh.com/dotfiles/file/tip/tmux/tmux.conf

# Options ──────────────────────────────────────────────────────────────────────

# Prefix
set-option -g prefix C-Space

# Fixes delay in modal applications
set-option -s -g escape-time 0

# Start numbering at 1
set-option -g base-index 1 # Window
set-option -w -g pane-base-index 1

# Automatically renumber windows
set-option -g renumber-windows

# Pass focus events through to applications
set-option -g focus-events on

# Mouse
set-option -g mouse on

# Clipboard
# Allows applications to set the clipboard.
set-option -s set-clipboard on

# Colors and attributes
set-option -g default-terminal tmux-256color

# Terminal features
# https://man.openbsd.org/tmux#terminal-features__
set-option -a -s terminal-features 'alacritty:RGB'

# Status line ──────────────────────────────────────────────────────────────────

# Status format for windows
# [1] 2 3
set-option -g window-status-format ' #{window_index} '
set-option -g window-status-current-format '[#{window_index}]'

# Hide status right
set-option -g status-right ''

# Bindings ─────────────────────────────────────────────────────────────────────

# Enter command mode
bind-key Enter command-prompt

# Reload the configuration
bind-key R {
  source-file ~/.config/tmux/tmux.conf
  display-message 'Reloaded configuration'
}

# dvtm-style pane selection
bind-key -n F1 select-pane -Z -t 1
bind-key -n F2 select-pane -Z -t 2
bind-key -n F3 select-pane -Z -t 3
bind-key -n F4 select-pane -Z -t 4
bind-key -n F5 select-pane -Z -t 5
bind-key -n F6 select-pane -Z -t 6
bind-key -n F7 select-pane -Z -t 7
bind-key -n F8 select-pane -Z -t 8
bind-key -n F9 select-pane -Z -t 9
bind-key -n F9 select-pane -Z -t 9

# Enter full-screen with the same, but add Shift.
bind-key -n S-F1 { select-pane -t 1; resize-pane -Z }
bind-key -n S-F2 { select-pane -t 2; resize-pane -Z }
bind-key -n S-F3 { select-pane -t 3; resize-pane -Z }
bind-key -n S-F4 { select-pane -t 4; resize-pane -Z }
bind-key -n S-F5 { select-pane -t 5; resize-pane -Z }
bind-key -n S-F6 { select-pane -t 6; resize-pane -Z }
bind-key -n S-F7 { select-pane -t 7; resize-pane -Z }
bind-key -n S-F8 { select-pane -t 8; resize-pane -Z }
bind-key -n S-F9 { select-pane -t 9; resize-pane -Z }
bind-key -n S-F9 { select-pane -t 9; resize-pane -Z }

# Display panes to switch
bind-key -n F10 display-panes -d 0

# Full-screen
bind-key -n F11 resize-pane -Z

# [s] ⇒ Select a session.
# [S] ⇒ Create a new session.
bind-key s choose-tree -Z -s
bind-key S command-prompt { new-session -s %% -c ~ }

# Rename session.
bind-key r command-prompt { rename-session %% }

# Window
bind-key c new-window -c '#{pane_current_path}'

# Split
bind-key o split-window -v -c '#{pane_current_path}'
bind-key O split-window -h -c '#{pane_current_path}'

# Popup
bind-key + display-popup -w 90% -h 90% -d '#{pane_current_path}' -E

# Panel
bind-key | split-window -h -b -l 30 -t '{left}' -c '#{pane_current_path}'

# Pane picker
bind-key Down choose-tree -Z { join-pane -v -s '%%' }
bind-key Right choose-tree -Z { join-pane -h -s '%%' }
bind-key Up display-panes -d 0 { join-pane -v -s '%%' }
bind-key Left display-panes -d 0 { join-pane -h -s '%%' }

# Detach the window in its own tab
bind-key D break-pane -d

# Kill focused pane and window
bind-key x kill-pane
bind-key X kill-window

# Focus panes
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Display panes to switch
bind-key q display-panes -d 0

# Move panes
bind-key H swap-pane -s '{left-of}'
bind-key J swap-pane -s '{down-of}'
bind-key K swap-pane -s '{up-of}'
bind-key L swap-pane -s '{right-of}'

# Resize panes
bind-key -r C-h resize-pane -L 5
bind-key -r C-j resize-pane -D 2
bind-key -r C-k resize-pane -U 2
bind-key -r C-l resize-pane -R 5

# Switch to window
# https://github.com/alexherbo2/tmux-tools
bind-key 1 run-shell 'tmux-select-window 1'
bind-key 2 run-shell 'tmux-select-window 2'
bind-key 3 run-shell 'tmux-select-window 3'
bind-key 4 run-shell 'tmux-select-window 4'
bind-key 5 run-shell 'tmux-select-window 5'
bind-key 6 run-shell 'tmux-select-window 6'
bind-key 7 run-shell 'tmux-select-window 7'
bind-key 8 run-shell 'tmux-select-window 8'
bind-key 9 run-shell 'tmux-select-window 9'
bind-key 0 run-shell 'tmux-select-window 10'

# Move focused pane to window
# Note: It is Shift + <number> on the US layout.
bind-key '!' run-shell 'tmux-move-pane-to-window 1'
bind-key '@' run-shell 'tmux-move-pane-to-window 2'
bind-key '#' run-shell 'tmux-move-pane-to-window 3'
bind-key '$' run-shell 'tmux-move-pane-to-window 4'
bind-key '%' run-shell 'tmux-move-pane-to-window 5'
bind-key '^' run-shell 'tmux-move-pane-to-window 6'
bind-key '&' run-shell 'tmux-move-pane-to-window 7'
bind-key '*' run-shell 'tmux-move-pane-to-window 8'
bind-key '(' run-shell 'tmux-move-pane-to-window 9'
bind-key ')' run-shell 'tmux-move-pane-to-window 10'

# Select next and previous windows
bind-key p select-window -t -1
bind-key n select-window -t +1

# Swap the current window with next/previous windows
bind-key -r P {
  swap-window -t -1
  previous-window
}

bind-key -r N {
  swap-window -t +1
  next-window
}

# Full-screen
bind-key f resize-pane -Z

# Copy mode ────────────────────────────────────────────────────────────────────

# Enter copy mode with Control + Space.

# vi key-bindings
set-option -g mode-keys vi

# Copy mode
bind-key C-Space copy-mode
bind-key -T copy-mode-vi i send-keys -X cancel

# Copy and paste
bind-key -T copy-mode-vi y send-keys -X copy-selection
bind-key -T copy-mode-vi Enter send-keys -X copy-selection-and-cancel
bind-key C-v paste-buffer

# Start selection
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi Escape send-keys -X clear-selection

# Long jumps
bind-key -T copy-mode-vi H send-keys -X start-of-line
bind-key -T copy-mode-vi L send-keys -X end-of-line
bind-key -T copy-mode-vi J send-keys -X page-down
bind-key -T copy-mode-vi K send-keys -X page-up
